{"version":3,"sources":["/Users/zweigen/Sites/daten-see-v2/src/shared/components/ErrorBoundary.tsx"],"sourcesContent":["'use client';\n\nimport * as Sentry from '@sentry/nextjs';\nimport React, { Component, ReactNode } from 'react';\n\nimport { appLogger } from '@/lib/monitoring/logger.config';\n\ninterface Props {\n  children: ReactNode;\n  fallback?: ReactNode;\n  level?: 'page' | 'widget' | 'component';\n  context?: Record<string, unknown>;\n}\n\ninterface State {\n  hasError: boolean;\n  error?: Error;\n  errorId?: string;\n}\n\nexport class ErrorBoundary extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error: Error): State {\n    return {\n      hasError: true,\n      error,\n    };\n  }\n\n  override componentDidCatch(error: Error, errorInfo: React.ErrorInfo): void {\n    const { level = 'component', context } = this.props;\n    \n    // Enhanced logging with context\n    appLogger.error(`Error Boundary Triggered (${level})`, {\n      error,\n      component: `error-boundary-${level}`,\n      metadata: {\n        componentStack: errorInfo.componentStack,\n        errorBoundaryLevel: level,\n        ...context,\n      },\n    });\n\n    // Capture to Sentry with enhanced context\n    Sentry.withScope((scope) => {\n      scope.setTag('errorBoundary', level);\n      scope.setLevel('error');\n      scope.setContext('errorInfo', {\n        componentStack: errorInfo.componentStack,\n        level,\n        ...context,\n      });\n      \n      const errorId = Sentry.captureException(error);\n      this.setState({ errorId });\n    });\n  }\n\n  private handleRetry = (): void => {\n    const { level = 'component' } = this.props;\n    appLogger.info('Error Boundary Retry Attempted', {\n      component: `error-boundary-${level}`,\n      action: 'retry',\n    });\n    \n    this.setState({ hasError: false });\n  };\n\n  private handleReportIssue = (): void => {\n    const { level = 'component' } = this.props;\n    if (this.state.errorId) {\n      appLogger.userAction('report-error', undefined, {\n        errorId: this.state.errorId,\n        errorBoundaryLevel: level,\n      });\n      \n      // In production, this could open a support ticket\n      if (typeof window !== 'undefined') {\n        window.open(\n          `mailto:support@daten-see.com?subject=Error Report - ${this.state.errorId}&body=Error ID: ${this.state.errorId}%0A%0APlease describe what you were doing when this error occurred.`,\n          '_blank'\n        );\n      }\n    }\n  };\n\n  override render(): ReactNode {\n    if (this.state.hasError) {\n      // Custom fallback UI or use provided fallback\n      if (this.props.fallback) {\n        return this.props.fallback;\n      }\n\n      const { level = 'component' } = this.props;\n      \n      return (\n        <div className=\"error-boundary-fallback\" data-level={level} role=\"alert\">\n          <div className=\"p-6 bg-red-50 border border-red-200 rounded-lg\">\n            <div className=\"flex items-start\">\n              <div className=\"flex-shrink-0\">\n                <svg\n                  className=\"w-5 h-5 text-red-400\"\n                  viewBox=\"0 0 20 20\"\n                  fill=\"currentColor\"\n                >\n                  <path\n                    fillRule=\"evenodd\"\n                    d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\"\n                    clipRule=\"evenodd\"\n                  />\n                </svg>\n              </div>\n              <div className=\"ml-3\">\n                <h3 className=\"text-sm font-medium text-red-800\">\n                  Oops! Etwas ist schiefgelaufen\n                </h3>\n                <div className=\"mt-2 text-sm text-red-700\">\n                  <p>\n                    {level === 'page' && 'Diese Seite ist auf einen Fehler gestoßen und kann nicht angezeigt werden.'}\n                    {level === 'widget' && 'Dieses Widget ist auf einen Fehler gestoßen und kann nicht angezeigt werden.'}\n                    {level === 'component' && 'Diese Komponente ist auf einen Fehler gestoßen.'}\n                  </p>\n                  \n                  {process.env.NODE_ENV === 'development' && this.state.error && (\n                    <details className=\"mt-2\">\n                      <summary className=\"cursor-pointer font-medium\">\n                        Development Error Details\n                      </summary>\n                      <pre className=\"mt-2 text-xs bg-red-100 p-2 rounded overflow-auto\">\n                        {this.state.error.message}\n                        {'\\n'}\n                        {this.state.error.stack}\n                      </pre>\n                    </details>\n                  )}\n                </div>\n                \n                <div className=\"mt-4 flex space-x-3\">\n                  <button\n                    onClick={this.handleRetry}\n                    className=\"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500\"\n                  >\n                    Seite neu laden\n                  </button>\n                  \n                  {this.state.errorId && process.env.NODE_ENV === 'production' && (\n                    <button\n                      onClick={this.handleReportIssue}\n                      className=\"bg-gray-600 text-white px-3 py-1 rounded text-sm hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500\"\n                    >\n                      Report Issue\n                    </button>\n                  )}\n                  \n                  {this.state.errorId && (\n                    <span className=\"text-xs text-gray-500 self-center\">\n                      Error ID: {this.state.errorId.slice(0, 8)}\n                    </span>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}"],"names":["ErrorBoundary","Component","props","handleRetry","level","appLogger","info","component","action","setState","hasError","handleReportIssue","state","errorId","userAction","undefined","errorBoundaryLevel","window","open","getDerivedStateFromError","error","componentDidCatch","errorInfo","context","metadata","componentStack","Sentry","withScope","scope","setTag","setLevel","setContext","captureException","render","fallback","div","className","data-level","role","svg","viewBox","fill","path","fillRule","d","clipRule","h3","p","process","env","NODE_ENV","details","summary","pre","message","stack","button","onClick","span","slice","children"],"mappings":"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"}